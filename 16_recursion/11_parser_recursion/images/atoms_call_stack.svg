<svg viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
  <rect width="1000" height="700" fill="#0f0f23"/>
  
  <!-- Title -->
  <text x="500" y="30" font-family="Courier New, monospace" font-size="22" font-weight="bold" fill="#ffffff" text-anchor="middle">Call Stack Visualization: Mg(OH)2</text>
  
  <!-- Input with position pointer -->
  <text x="500" y="60" font-family="Courier New, monospace" font-size="12" fill="#888888" text-anchor="middle">Watch how the call stack grows and shrinks</text>
  
  <!-- Character boxes -->
  <rect x="350" y="75" width="40" height="35" rx="3" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
  <text x="370" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#4ade80" text-anchor="middle">M</text>
  
  <rect x="395" y="75" width="40" height="35" rx="3" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
  <text x="415" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#4ade80" text-anchor="middle">g</text>
  
  <rect x="440" y="75" width="40" height="35" rx="3" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
  <text x="460" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#f97316" text-anchor="middle">(</text>
  
  <rect x="485" y="75" width="40" height="35" rx="3" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="505" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">O</text>
  
  <rect x="530" y="75" width="40" height="35" rx="3" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="550" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">H</text>
  
  <rect x="575" y="75" width="40" height="35" rx="3" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
  <text x="595" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#f97316" text-anchor="middle">)</text>
  
  <rect x="620" y="75" width="40" height="35" rx="3" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
  <text x="640" y="98" font-family="Courier New, monospace" font-size="16" font-weight="bold" fill="#a78bfa" text-anchor="middle">2</text>
  
  <!-- Phase labels -->
  <text x="110" y="150" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#e94560">PHASE 1</text>
  <text x="280" y="150" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#e94560">PHASE 2</text>
  <text x="450" y="150" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#e94560">PHASE 3</text>
  <text x="620" y="150" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#e94560">PHASE 4</text>
  <text x="790" y="150" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#e94560">PHASE 5</text>
  
  <!-- Phase 1: Initial call -->
  <rect x="50" y="165" width="130" height="180" rx="6" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="115" y="190" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#3b82f6" text-anchor="middle">parseFormula</text>
  <text x="115" y="210" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">pos: 0</text>
  
  <rect x="65" y="225" width="100" height="30" rx="3" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
  <text x="115" y="245" font-family="Courier New, monospace" font-size="9" fill="#4ade80" text-anchor="middle">parseAtom()</text>
  <text x="115" y="270" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">→ Mg, count=1</text>
  
  <text x="115" y="300" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">counts:</text>
  <rect x="70" y="305" width="90" height="25" rx="3" fill="#0f0f23" stroke="#4ade80" stroke-width="1"/>
  <text x="115" y="322" font-family="Courier New, monospace" font-size="9" fill="#4ade80" text-anchor="middle">{Mg: 1}</text>
  
  <!-- Phase 2: See ( and push -->
  <rect x="200" y="165" width="130" height="180" rx="6" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="265" y="190" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#3b82f6" text-anchor="middle">parseFormula</text>
  <text x="265" y="210" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">pos: 2</text>
  
  <rect x="215" y="225" width="100" height="30" rx="3" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
  <text x="265" y="245" font-family="Courier New, monospace" font-size="9" fill="#f97316" text-anchor="middle">parseGroup()</text>
  <text x="265" y="270" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">see '(' PUSH!</text>
  
  <!-- Nested call -->
  <rect x="215" y="280" width="100" height="45" rx="3" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
  <text x="265" y="300" font-family="Courier New, monospace" font-size="9" fill="#a78bfa" text-anchor="middle">parseFormula</text>
  <text x="265" y="318" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">NESTED pos:3</text>
  
  <!-- Arrow showing stack growth -->
  <path d="M 180 280 L 200 280" stroke="#f97316" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Phase 3: Inside nested -->
  <rect x="370" y="165" width="130" height="260" rx="6" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="435" y="190" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#3b82f6" text-anchor="middle">parseFormula</text>
  
  <rect x="385" y="205" width="100" height="35" rx="3" fill="#3d1f0f" stroke="#f97316" stroke-width="1"/>
  <text x="435" y="222" font-family="Courier New, monospace" font-size="9" fill="#f97316" text-anchor="middle">parseGroup</text>
  
  <rect x="385" y="245" width="100" height="110" rx="3" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
  <text x="435" y="265" font-family="Courier New, monospace" font-size="9" fill="#a78bfa" text-anchor="middle">parseFormula</text>
  <text x="435" y="283" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">ACTIVE pos:3</text>
  
  <rect x="395" y="295" width="80" height="22" rx="2" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
  <text x="435" y="310" font-family="Courier New, monospace" font-size="8" fill="#4ade80" text-anchor="middle">→ O, cnt=1</text>
  
  <rect x="395" y="322" width="80" height="22" rx="2" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
  <text x="435" y="337" font-family="Courier New, monospace" font-size="8" fill="#4ade80" text-anchor="middle">→ H, cnt=1</text>
  
  <text x="435" y="375" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">{O:1, H:1}</text>
  <text x="435" y="410" font-family="Courier New, monospace" font-size="9" fill="#f97316" text-anchor="middle">see ')' POP!</text>
  
  <!-- Phase 4: Popping -->
  <rect x="540" y="165" width="130" height="180" rx="6" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
  <text x="605" y="190" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#3b82f6" text-anchor="middle">parseFormula</text>
  
  <rect x="555" y="205" width="100" height="100" rx="3" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
  <text x="605" y="225" font-family="Courier New, monospace" font-size="9" fill="#f97316" text-anchor="middle">parseGroup</text>
  <text x="605" y="245" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">Back from nest</text>
  <text x="605" y="265" font-family="Courier New, monospace" font-size="8" fill="#ffffff" text-anchor="middle">got {O:1, H:1}</text>
  <text x="605" y="285" font-family="Courier New, monospace" font-size="8" fill="#a78bfa" text-anchor="middle">read '2' mult</text>
  <text x="605" y="300" font-family="Courier New, monospace" font-size="8" fill="#4ade80" text-anchor="middle">{O:2, H:2}</text>
  
  <text x="605" y="330" font-family="Courier New, monospace" font-size="9" fill="#4ade80" text-anchor="middle">Return to outer</text>
  
  <!-- Phase 5: Final -->
  <rect x="710" y="165" width="130" height="180" rx="6" fill="#0f2f1f" stroke="#4ade80" stroke-width="3"/>
  <text x="775" y="190" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#4ade80" text-anchor="middle">parseFormula</text>
  <text x="775" y="210" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">pos: 7 (END)</text>
  
  <text x="775" y="240" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">Merge counts:</text>
  <text x="775" y="260" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">{Mg:1}</text>
  <text x="775" y="275" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">+ {O:2, H:2}</text>
  
  <rect x="725" y="290" width="100" height="35" rx="4" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
  <text x="775" y="313" font-family="Courier New, monospace" font-size="10" font-weight="bold" fill="#4ade80" text-anchor="middle">H2MgO2</text>
  
  <!-- Stack depth indicator -->
  <text x="50" y="470" font-family="Courier New, monospace" font-size="12" font-weight="bold" fill="#e94560">Stack Depth Over Time:</text>
  
  <!-- Timeline -->
  <line x1="50" y1="550" x2="900" y2="550" stroke="#3b82f6" stroke-width="2"/>
  
  <!-- Stack depth bars -->
  <rect x="100" y="520" width="80" height="30" rx="2" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
  <text x="140" y="540" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">depth=1</text>
  
  <rect x="250" y="490" width="80" height="60" rx="2" fill="#2d1f3d" stroke="#a78bfa" stroke-width="1"/>
  <text x="290" y="510" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">depth=2</text>
  <text x="290" y="525" font-family="Courier New, monospace" font-size="8" fill="#888888" text-anchor="middle">nested</text>
  
  <rect x="400" y="490" width="80" height="60" rx="2" fill="#2d1f3d" stroke="#a78bfa" stroke-width="1"/>
  <text x="440" y="525" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">depth=2</text>
  
  <rect x="550" y="520" width="80" height="30" rx="2" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
  <text x="590" y="540" font-family="Courier New, monospace" font-size="9" fill="#ffffff" text-anchor="middle">depth=1</text>
  
  <rect x="700" y="520" width="80" height="30" rx="2" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
  <text x="740" y="540" font-family="Courier New, monospace" font-size="9" fill="#4ade80" text-anchor="middle">done!</text>
  
  <!-- Time labels -->
  <text x="140" y="575" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">parse Mg</text>
  <text x="290" y="575" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">enter (</text>
  <text x="440" y="575" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">parse OH</text>
  <text x="590" y="575" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">exit )</text>
  <text x="740" y="575" font-family="Courier New, monospace" font-size="9" fill="#888888" text-anchor="middle">merge</text>
  
  <!-- Legend -->
  <rect x="50" y="610" width="400" height="75" rx="6" fill="#0f0f23" stroke="#3b82f6" stroke-width="1"/>
  <text x="70" y="635" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#ffffff">Legend:</text>
  <rect x="70" y="645" width="15" height="15" fill="#1e3a5f" stroke="#3b82f6"/>
  <text x="95" y="657" font-family="Courier New, monospace" font-size="9" fill="#888888">parseFormula (outer)</text>
  <rect x="200" y="645" width="15" height="15" fill="#2d1f3d" stroke="#a78bfa"/>
  <text x="225" y="657" font-family="Courier New, monospace" font-size="9" fill="#888888">parseFormula (nested)</text>
  <rect x="350" y="645" width="15" height="15" fill="#3d1f0f" stroke="#f97316"/>
  <text x="375" y="657" font-family="Courier New, monospace" font-size="9" fill="#888888">parseGroup</text>
  
  <!-- Arrow marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f97316"/>
    </marker>
  </defs>
</svg>

