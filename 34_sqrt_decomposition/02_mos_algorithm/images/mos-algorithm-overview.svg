<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 750">
  <rect width="950" height="750" fill="#0f0f23"/>
  
  <!-- Title -->
  <text x="475" y="40" text-anchor="middle" font-family="Courier New, monospace" font-size="26" font-weight="bold" fill="#ffffff">ðŸ”„ Mo's Algorithm</text>
  <text x="475" y="65" text-anchor="middle" font-family="Courier New, monospace" font-size="16" fill="#888888">Offline Query Processing â€¢ O((n+q)âˆšn)</text>
  
  <!-- Core Concept -->
  <text x="50" y="110" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Core Concept: Query Reordering</text>
  
  <g transform="translate(50, 130)">
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Instead of processing queries in given order, sort them to minimize pointer movements</text>
    
    <rect x="0" y="15" width="400" height="80" fill="none" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="15" y="40" font-family="Courier New, monospace" font-size="11" fill="#ffffff">Sort Key: (left // block_size, right)</text>
    <text x="15" y="60" font-family="Courier New, monospace" font-size="11" fill="#888888">1. Primary: Block of left endpoint</text>
    <text x="15" y="80" font-family="Courier New, monospace" font-size="11" fill="#888888">2. Secondary: Right endpoint value</text>
  </g>
  
  <!-- Example Setup -->
  <text x="500" y="110" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Example Setup</text>
  
  <g transform="translate(500, 130)">
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Array: [1, 2, 1, 3, 4, 2, 5, 1, 3, 4]  n=10, block_size=âˆš10â‰ˆ3</text>
    
    <!-- Array visualization -->
    <g transform="translate(0, 20)">
      <!-- Block 0 -->
      <rect x="0" y="0" width="28" height="28" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="14" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">1</text>
      <rect x="32" y="0" width="28" height="28" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="46" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">2</text>
      <rect x="64" y="0" width="28" height="28" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="78" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">1</text>
      
      <!-- Block 1 -->
      <rect x="100" y="0" width="28" height="28" fill="#3d1f0f" stroke="#f97316" stroke-width="1.5"/>
      <text x="114" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">3</text>
      <rect x="132" y="0" width="28" height="28" fill="#3d1f0f" stroke="#f97316" stroke-width="1.5"/>
      <text x="146" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">4</text>
      <rect x="164" y="0" width="28" height="28" fill="#3d1f0f" stroke="#f97316" stroke-width="1.5"/>
      <text x="178" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">2</text>
      
      <!-- Block 2 -->
      <rect x="200" y="0" width="28" height="28" fill="#0f2f1f" stroke="#4ade80" stroke-width="1.5"/>
      <text x="214" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">5</text>
      <rect x="232" y="0" width="28" height="28" fill="#0f2f1f" stroke="#4ade80" stroke-width="1.5"/>
      <text x="246" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">1</text>
      <rect x="264" y="0" width="28" height="28" fill="#0f2f1f" stroke="#4ade80" stroke-width="1.5"/>
      <text x="278" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">3</text>
      <rect x="296" y="0" width="28" height="28" fill="#2d1f3d" stroke="#a78bfa" stroke-width="1.5"/>
      <text x="310" y="18" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">4</text>
      
      <!-- Index labels -->
      <text x="14" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">0</text>
      <text x="46" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">1</text>
      <text x="78" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">2</text>
      <text x="114" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">3</text>
      <text x="146" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">4</text>
      <text x="178" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">5</text>
      <text x="214" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">6</text>
      <text x="246" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">7</text>
      <text x="278" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">8</text>
      <text x="310" y="45" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">9</text>
      
      <!-- Block labels -->
      <text x="46" y="60" text-anchor="middle" font-family="Courier New, monospace" font-size="9" fill="#3b82f6">Block 0</text>
      <text x="146" y="60" text-anchor="middle" font-family="Courier New, monospace" font-size="9" fill="#f97316">Block 1</text>
      <text x="260" y="60" text-anchor="middle" font-family="Courier New, monospace" font-size="9" fill="#4ade80">Block 2+</text>
    </g>
  </g>
  
  <!-- Query Sorting -->
  <text x="50" y="270" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Step 1: Sort Queries</text>
  
  <g transform="translate(50, 290)">
    <!-- Unsorted queries -->
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Unsorted Queries:</text>
    
    <rect x="0" y="15" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="40" y="32" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">Q1: [0, 4]</text>
    <rect x="85" y="15" width="80" height="25" fill="#3d1f0f" stroke="#f97316" stroke-width="1"/>
    <text x="125" y="32" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">Q2: [5, 9]</text>
    <rect x="170" y="15" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="210" y="32" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">Q3: [2, 6]</text>
    <rect x="255" y="15" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="295" y="32" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#ffffff">Q4: [1, 5]</text>
    
    <!-- Arrow -->
    <text x="170" y="65" font-family="Courier New, monospace" font-size="16" fill="#4ade80">â†“ Sort by (L//3, R)</text>
    
    <!-- Sorted queries -->
    <text x="0" y="90" font-family="Courier New, monospace" font-size="11" fill="#888888">Sorted Queries:</text>
    
    <rect x="0" y="105" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
    <text x="40" y="122" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q1: [0, 4]</text>
    <text x="40" y="145" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">(0, 4)</text>
    
    <rect x="85" y="105" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
    <text x="125" y="122" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q4: [1, 5]</text>
    <text x="125" y="145" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">(0, 5)</text>
    
    <rect x="170" y="105" width="80" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
    <text x="210" y="122" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q3: [2, 6]</text>
    <text x="210" y="145" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">(0, 6)</text>
    
    <rect x="255" y="105" width="80" height="25" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
    <text x="295" y="122" text-anchor="middle" font-family="Courier New, monospace" font-size="10" fill="#f97316">Q2: [5, 9]</text>
    <text x="295" y="145" text-anchor="middle" font-family="Courier New, monospace" font-size="8" fill="#888888">(1, 9)</text>
    
    <text x="0" y="165" font-family="Courier New, monospace" font-size="10" fill="#4ade80">Block 0 queries sorted by R: 4 â†’ 5 â†’ 6</text>
  </g>
  
  <!-- Processing Steps -->
  <text x="500" y="270" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Step 2: Process with Two Pointers</text>
  
  <g transform="translate(500, 290)">
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Maintain L, R pointers and current answer</text>
    
    <!-- Q1 processing -->
    <rect x="0" y="15" width="380" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="10" y="35" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q1 [0,4]: L=0, R=-1 â†’ expand R to 4</text>
    <text x="280" y="35" font-family="Courier New, monospace" font-size="10" fill="#4ade80">5 moves</text>
    
    <!-- Q4 processing -->
    <rect x="0" y="55" width="380" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="10" y="75" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q4 [1,5]: L 0â†’1, R 4â†’5</text>
    <text x="280" y="75" font-family="Courier New, monospace" font-size="10" fill="#4ade80">2 moves</text>
    
    <!-- Q3 processing -->
    <rect x="0" y="95" width="380" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="10" y="115" font-family="Courier New, monospace" font-size="10" fill="#3b82f6">Q3 [2,6]: L 1â†’2, R 5â†’6</text>
    <text x="280" y="115" font-family="Courier New, monospace" font-size="10" fill="#4ade80">2 moves</text>
    
    <!-- Q2 processing -->
    <rect x="0" y="135" width="380" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="1"/>
    <text x="10" y="155" font-family="Courier New, monospace" font-size="10" fill="#f97316">Q2 [5,9]: L 2â†’5, R 6â†’9</text>
    <text x="280" y="155" font-family="Courier New, monospace" font-size="10" fill="#4ade80">6 moves</text>
    
    <text x="0" y="190" font-family="Courier New, monospace" font-size="11" fill="#4ade80">Total: 15 moves (vs ~30 without sorting)</text>
  </g>
  
  <!-- Add/Remove Operations -->
  <text x="50" y="500" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Add/Remove Operations (Distinct Count Example)</text>
  
  <g transform="translate(50, 520)">
    <rect x="0" y="0" width="400" height="120" fill="none" stroke="#4ade80" stroke-width="1.5"/>
    
    <text x="15" y="25" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#4ade80">add(idx):</text>
    <text x="25" y="45" font-family="Courier New, monospace" font-size="10" fill="#ffffff">freq[arr[idx]] += 1</text>
    <text x="25" y="62" font-family="Courier New, monospace" font-size="10" fill="#ffffff">if freq[arr[idx]] == 1:</text>
    <text x="40" y="79" font-family="Courier New, monospace" font-size="10" fill="#ffffff">distinct_count += 1</text>
    
    <text x="210" y="25" font-family="Courier New, monospace" font-size="11" font-weight="bold" fill="#ef4444">remove(idx):</text>
    <text x="220" y="45" font-family="Courier New, monospace" font-size="10" fill="#ffffff">freq[arr[idx]] -= 1</text>
    <text x="220" y="62" font-family="Courier New, monospace" font-size="10" fill="#ffffff">if freq[arr[idx]] == 0:</text>
    <text x="235" y="79" font-family="Courier New, monospace" font-size="10" fill="#ffffff">distinct_count -= 1</text>
    
    <text x="15" y="105" font-family="Courier New, monospace" font-size="10" fill="#888888">Operations must be O(1) and reversible!</text>
  </g>
  
  <!-- Complexity Analysis -->
  <text x="500" y="500" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Complexity Analysis</text>
  
  <g transform="translate(500, 520)">
    <rect x="0" y="0" width="400" height="120" fill="none" stroke="#3b82f6" stroke-width="1.5"/>
    
    <text x="15" y="25" font-family="Courier New, monospace" font-size="11" fill="#ffffff">Right pointer R:</text>
    <text x="160" y="25" font-family="Courier New, monospace" font-size="11" fill="#4ade80">O(n) per block Ã— âˆšn blocks = O(nâˆšn)</text>
    
    <text x="15" y="50" font-family="Courier New, monospace" font-size="11" fill="#ffffff">Left pointer L:</text>
    <text x="160" y="50" font-family="Courier New, monospace" font-size="11" fill="#4ade80">O(âˆšn) per query Ã— q queries = O(qâˆšn)</text>
    
    <line x1="15" y1="65" x2="385" y2="65" stroke="#888888" stroke-width="0.5"/>
    
    <text x="15" y="85" font-family="Courier New, monospace" font-size="12" font-weight="bold" fill="#f97316">Total Time: O((n + q) Ã— âˆšn)</text>
    <text x="15" y="105" font-family="Courier New, monospace" font-size="10" fill="#888888">Much better than O(n Ã— q) naive approach!</text>
  </g>
  
  <!-- When to Use -->
  <rect x="50" y="665" width="850" height="60" fill="none" stroke="#e94560" stroke-width="1.5"/>
  <text x="475" y="690" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">When to Use Mo's Algorithm</text>
  <text x="475" y="712" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#60a5fa">âœ“ Offline queries â€¢ âœ“ Reversible add/remove â€¢ âœ“ O(1) operations â€¢ âœ— Online queries</text>
</svg>

