<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 700">
  <rect width="950" height="700" fill="#0f0f23"/>
  
  <!-- Title -->
  <text x="475" y="40" text-anchor="middle" font-family="Courier New, monospace" font-size="26" font-weight="bold" fill="#ffffff">üîÑ Range Update with Lazy Propagation</text>
  <text x="475" y="65" text-anchor="middle" font-family="Courier New, monospace" font-size="16" fill="#888888">Range Add O(‚àön) ‚Ä¢ Range Query O(‚àön)</text>
  
  <!-- Initial State -->
  <text x="50" y="110" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Initial State</text>
  
  <g transform="translate(50, 130)">
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Array: [1, 2, 3, 4, 5, 6, 7, 8, 9]  block_size=3</text>
    
    <!-- Array -->
    <g transform="translate(0, 20)">
      <rect x="0" y="0" width="35" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
      <text x="17" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">1</text>
      <rect x="40" y="0" width="35" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
      <text x="57" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">2</text>
      <rect x="80" y="0" width="35" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
      <text x="97" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">3</text>
      
      <line x1="120" y1="-5" x2="120" y2="45" stroke="#f97316" stroke-width="2" stroke-dasharray="3,2"/>
      
      <rect x="125" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="142" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">4</text>
      <rect x="165" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="182" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">5</text>
      <rect x="205" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="222" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">6</text>
      
      <line x1="245" y1="-5" x2="245" y2="45" stroke="#4ade80" stroke-width="2" stroke-dasharray="3,2"/>
      
      <rect x="250" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="267" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">7</text>
      <rect x="290" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="307" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">8</text>
      <rect x="330" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="347" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">9</text>
    </g>
    
    <!-- Block sums and lazy -->
    <text x="0" y="80" font-family="Courier New, monospace" font-size="11" fill="#888888">Block Sums:</text>
    <rect x="100" y="65" width="45" height="25" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
    <text x="122" y="83" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#ffffff">6</text>
    <rect x="150" y="65" width="45" height="25" fill="#3d1f0f" stroke="#f97316" stroke-width="1"/>
    <text x="172" y="83" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#ffffff">15</text>
    <rect x="200" y="65" width="45" height="25" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
    <text x="222" y="83" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#ffffff">24</text>
    
    <text x="0" y="115" font-family="Courier New, monospace" font-size="11" fill="#888888">Lazy Array:</text>
    <rect x="100" y="100" width="45" height="25" fill="#1f0f1f" stroke="#888888" stroke-width="1"/>
    <text x="122" y="118" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#888888">0</text>
    <rect x="150" y="100" width="45" height="25" fill="#1f0f1f" stroke="#888888" stroke-width="1"/>
    <text x="172" y="118" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#888888">0</text>
    <rect x="200" y="100" width="45" height="25" fill="#1f0f1f" stroke="#888888" stroke-width="1"/>
    <text x="222" y="118" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#888888">0</text>
  </g>
  
  <!-- Range Update Operation -->
  <text x="500" y="110" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">range_add(1, 7, +5)</text>
  <text x="500" y="130" font-family="Courier New, monospace" font-size="11" fill="#888888">Add 5 to all elements in range [1, 7]</text>
  
  <g transform="translate(500, 150)">
    <!-- Visual representation of update -->
    <g transform="translate(0, 10)">
      <rect x="0" y="0" width="30" height="30" fill="#1e3a5f" stroke="#3b82f6" stroke-width="1"/>
      <text x="15" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#888888">1</text>
      
      <!-- Partial left - update directly -->
      <rect x="35" y="0" width="30" height="30" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
      <text x="50" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#a78bfa">7</text>
      <rect x="70" y="0" width="30" height="30" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
      <text x="85" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#a78bfa">8</text>
      
      <!-- Complete block - use lazy -->
      <rect x="110" y="0" width="30" height="30" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="125" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#f97316">4</text>
      <rect x="145" y="0" width="30" height="30" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="160" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#f97316">5</text>
      <rect x="180" y="0" width="30" height="30" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="195" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#f97316">6</text>
      
      <!-- Partial right - update directly -->
      <rect x="220" y="0" width="30" height="30" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
      <text x="235" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#a78bfa">12</text>
      <rect x="255" y="0" width="30" height="30" fill="#2d1f3d" stroke="#a78bfa" stroke-width="2"/>
      <text x="270" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#a78bfa">13</text>
      
      <rect x="290" y="0" width="30" height="30" fill="#0f2f1f" stroke="#4ade80" stroke-width="1"/>
      <text x="305" y="20" text-anchor="middle" font-family="Courier New, monospace" font-size="11" fill="#888888">9</text>
    </g>
    
    <text x="0" y="60" font-family="Courier New, monospace" font-size="10" fill="#a78bfa">‚ñ≤ Partial blocks: update arr[i] += 5</text>
    <text x="110" y="60" font-family="Courier New, monospace" font-size="10" fill="#f97316">‚ñ≤ Complete block: lazy[1] += 5</text>
  </g>
  
  <!-- After Update State -->
  <text x="50" y="310" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">After range_add(1, 7, +5)</text>
  
  <g transform="translate(50, 330)">
    <!-- Updated array -->
    <g transform="translate(0, 0)">
      <rect x="0" y="0" width="35" height="35" fill="#1e3a5f" stroke="#3b82f6" stroke-width="2"/>
      <text x="17" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">1</text>
      <rect x="40" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="57" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#4ade80">7</text>
      <rect x="80" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="97" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#4ade80">8</text>
      
      <line x1="120" y1="-5" x2="120" y2="45" stroke="#f97316" stroke-width="2" stroke-dasharray="3,2"/>
      
      <!-- Block 1 - values unchanged, lazy stores +5 -->
      <rect x="125" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="142" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#f97316">4</text>
      <rect x="165" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="182" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#f97316">5</text>
      <rect x="205" y="0" width="35" height="35" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
      <text x="222" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#f97316">6</text>
      
      <line x1="245" y1="-5" x2="245" y2="45" stroke="#4ade80" stroke-width="2" stroke-dasharray="3,2"/>
      
      <rect x="250" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="267" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#4ade80">12</text>
      <rect x="290" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="307" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#4ade80">13</text>
      <rect x="330" y="0" width="35" height="35" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
      <text x="347" y="23" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">9</text>
    </g>
    
    <!-- Block sums and lazy - updated -->
    <text x="0" y="60" font-family="Courier New, monospace" font-size="11" fill="#888888">Block Sums:</text>
    <rect x="100" y="45" width="50" height="25" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
    <text x="125" y="63" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#4ade80">16</text>
    <rect x="155" y="45" width="50" height="25" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
    <text x="180" y="63" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#f97316">30</text>
    <rect x="210" y="45" width="50" height="25" fill="#0f2f1f" stroke="#4ade80" stroke-width="2"/>
    <text x="235" y="63" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#4ade80">34</text>
    
    <text x="0" y="95" font-family="Courier New, monospace" font-size="11" fill="#888888">Lazy Array:</text>
    <rect x="100" y="80" width="50" height="25" fill="#1f0f1f" stroke="#888888" stroke-width="1"/>
    <text x="125" y="98" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#888888">0</text>
    <rect x="155" y="80" width="50" height="25" fill="#3d1f0f" stroke="#f97316" stroke-width="2"/>
    <text x="180" y="98" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#f97316">5</text>
    <rect x="210" y="80" width="50" height="25" fill="#1f0f1f" stroke="#888888" stroke-width="1"/>
    <text x="235" y="98" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#888888">0</text>
    
    <text x="280" y="92" font-family="Courier New, monospace" font-size="10" fill="#f97316">‚Üê lazy[1]=5 means "add 5 to all Block 1 elements"</text>
  </g>
  
  <!-- Query with Lazy -->
  <text x="500" y="310" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#e94560">Query sum(3, 5) with Lazy</text>
  
  <g transform="translate(500, 335)">
    <text x="0" y="0" font-family="Courier New, monospace" font-size="11" fill="#888888">Query elements in Block 1 (indices 3-5)</text>
    
    <text x="0" y="30" font-family="Courier New, monospace" font-size="11" fill="#ffffff">for i in range(3, 6):</text>
    <text x="20" y="50" font-family="Courier New, monospace" font-size="11" fill="#ffffff">result += arr[i] + lazy[1]</text>
    
    <text x="0" y="80" font-family="Courier New, monospace" font-size="11" fill="#4ade80">= (4+5) + (5+5) + (6+5)</text>
    <text x="0" y="100" font-family="Courier New, monospace" font-size="11" fill="#4ade80">= 9 + 10 + 11 = 30 ‚úì</text>
  </g>
  
  <!-- Key Insight -->
  <rect x="50" y="480" width="400" height="100" fill="none" stroke="#a78bfa" stroke-width="2"/>
  <text x="60" y="505" font-family="Courier New, monospace" font-size="12" font-weight="bold" fill="#a78bfa">üí° Lazy Propagation Key Idea</text>
  <text x="60" y="530" font-family="Courier New, monospace" font-size="11" fill="#ffffff">‚Ä¢ Partial blocks: Update elements directly</text>
  <text x="60" y="550" font-family="Courier New, monospace" font-size="11" fill="#ffffff">‚Ä¢ Complete blocks: Store update in lazy[]</text>
  <text x="60" y="570" font-family="Courier New, monospace" font-size="11" fill="#888888">Real value = arr[i] + lazy[block_of_i]</text>
  
  <!-- Complexity -->
  <rect x="480" y="480" width="420" height="100" fill="none" stroke="#3b82f6" stroke-width="2"/>
  <text x="490" y="505" font-family="Courier New, monospace" font-size="12" font-weight="bold" fill="#3b82f6">üìä Complexity Analysis</text>
  <text x="490" y="530" font-family="Courier New, monospace" font-size="11" fill="#ffffff">Range Update: O(‚àön) - 2 partials + ‚àön lazy</text>
  <text x="490" y="550" font-family="Courier New, monospace" font-size="11" fill="#ffffff">Range Query:  O(n) naive or O(‚àön) optimized</text>
  <text x="490" y="570" font-family="Courier New, monospace" font-size="11" fill="#888888">Space: O(n) array + O(‚àön) lazy + O(‚àön) blocks</text>
  
  <!-- Bottom Summary -->
  <rect x="50" y="610" width="850" height="60" fill="none" stroke="#e94560" stroke-width="1.5"/>
  <text x="475" y="635" text-anchor="middle" font-family="Courier New, monospace" font-size="14" font-weight="bold" fill="#ffffff">Lazy Propagation: Defer updates to complete blocks for O(‚àön) range updates</text>
  <text x="475" y="655" text-anchor="middle" font-family="Courier New, monospace" font-size="12" fill="#60a5fa">Apply lazy value when querying: actual_value = arr[i] + lazy[i // block_size]</text>
</svg>

