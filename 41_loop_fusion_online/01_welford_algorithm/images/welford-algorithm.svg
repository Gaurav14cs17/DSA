<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600">
  <defs>
    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#6c63ff;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#4834df;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ee5a6f;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4ecdc4;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#44a08d;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="600" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="500" y="40" font-family="Arial, sans-serif" font-size="32" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Welford's Algorithm: Online Variance
  </text>
  <text x="500" y="70" font-family="Arial, sans-serif" font-size="16" text-anchor="middle" fill="#7f8c8d">
    Numerically Stable One-Pass Computation
  </text>
  
  <!-- Data Stream -->
  <g transform="translate(50, 100)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#2c3e50">
      Data Stream:
    </text>
    <rect x="120" y="-20" width="50" height="35" fill="#fff" stroke="#6c63ff" stroke-width="2" rx="3"/>
    <text x="145" y="5" font-family="monospace" font-size="16" text-anchor="middle" fill="#2c3e50">10</text>
    
    <rect x="180" y="-20" width="50" height="35" fill="#fff" stroke="#6c63ff" stroke-width="2" rx="3"/>
    <text x="205" y="5" font-family="monospace" font-size="16" text-anchor="middle" fill="#2c3e50">20</text>
    
    <rect x="240" y="-20" width="50" height="35" fill="#fff" stroke="#6c63ff" stroke-width="2" rx="3"/>
    <text x="265" y="5" font-family="monospace" font-size="16" text-anchor="middle" fill="#2c3e50">30</text>
    
    <rect x="300" y="-20" width="50" height="35" fill="#fff" stroke="#6c63ff" stroke-width="2" rx="3"/>
    <text x="325" y="5" font-family="monospace" font-size="16" text-anchor="middle" fill="#2c3e50">40</text>
    
    <rect x="360" y="-20" width="50" height="35" fill="#fff" stroke="#6c63ff" stroke-width="2" rx="3"/>
    <text x="385" y="5" font-family="monospace" font-size="16" text-anchor="middle" fill="#2c3e50">50</text>
    
    <text x="430" y="5" font-family="monospace" font-size="20" text-anchor="middle" fill="#7f8c8d">...</text>
  </g>
  
  <!-- Algorithm Steps -->
  <g transform="translate(50, 180)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
      Update Recurrences:
    </text>
    
    <!-- Step 1: Mean Update -->
    <g transform="translate(0, 30)">
      <rect x="0" y="0" width="420" height="60" fill="url(#grad1)" stroke="#6c63ff" stroke-width="2" rx="5"/>
      <text x="210" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
        Mean Update
      </text>
      <text x="210" y="45" font-family="monospace" font-size="13" text-anchor="middle" fill="#fff">
        Œº‚Çô = Œº‚Çô‚Çã‚ÇÅ + (x‚Çô - Œº‚Çô‚Çã‚ÇÅ) / n
      </text>
    </g>
    
    <!-- Step 2: Variance Update -->
    <g transform="translate(0, 100)">
      <rect x="0" y="0" width="420" height="80" fill="url(#grad2)" stroke="#ff6b6b" stroke-width="2" rx="5"/>
      <text x="210" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
        Variance Update
      </text>
      <text x="210" y="45" font-family="monospace" font-size="13" text-anchor="middle" fill="#fff">
        M‚ÇÇ(n) = M‚ÇÇ(n-1) + (x‚Çô - Œº‚Çô‚Çã‚ÇÅ)(x‚Çô - Œº‚Çô)
      </text>
      <text x="210" y="65" font-family="monospace" font-size="13" text-anchor="middle" fill="#fff">
        œÉ¬≤‚Çô = M‚ÇÇ(n) / n
      </text>
    </g>
    
    <!-- Properties Box -->
    <g transform="translate(0, 200)">
      <rect x="0" y="0" width="420" height="100" fill="#fff" stroke="#4ecdc4" stroke-width="2" rx="5"/>
      <text x="210" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2c3e50">
        Properties
      </text>
      <text x="20" y="50" font-family="Arial, sans-serif" font-size="13" text-anchor="start" fill="#2c3e50">
        ‚úì Time: O(1) per update
      </text>
      <text x="20" y="70" font-family="Arial, sans-serif" font-size="13" text-anchor="start" fill="#2c3e50">
        ‚úì Space: O(1) total
      </text>
      <text x="20" y="90" font-family="Arial, sans-serif" font-size="13" text-anchor="start" fill="#2c3e50">
        ‚úì Numerically stable
      </text>
    </g>
  </g>
  
  <!-- Visual Example -->
  <g transform="translate(520, 180)">
    <text x="0" y="0" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">
      Example: Adding x‚ÇÉ = 30
    </text>
    
    <!-- State Before -->
    <g transform="translate(0, 30)">
      <rect x="0" y="0" width="200" height="100" fill="#fff" stroke="#7f8c8d" stroke-width="2" rx="5"/>
      <text x="100" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#e74c3c">
        Before (n=2)
      </text>
      <text x="20" y="50" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        n = 2
      </text>
      <text x="20" y="70" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        Œº = 15.0
      </text>
      <text x="20" y="90" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        M‚ÇÇ = 50.0
      </text>
    </g>
    
    <!-- Arrow -->
    <g transform="translate(100, 145)">
      <line x1="0" y1="0" x2="0" y2="30" stroke="#27ae60" stroke-width="3"/>
      <polygon points="0,30 -5,20 5,20" fill="#27ae60"/>
    </g>
    
    <!-- Computation -->
    <g transform="translate(220, 30)">
      <rect x="0" y="0" width="240" height="145" fill="url(#grad3)" stroke="#4ecdc4" stroke-width="2" rx="5"/>
      <text x="120" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">
        Computation
      </text>
      <text x="10" y="50" font-family="monospace" font-size="12" text-anchor="start" fill="#fff">
        Œ¥ = 30 - 15 = 15
      </text>
      <text x="10" y="70" font-family="monospace" font-size="12" text-anchor="start" fill="#fff">
        Œº‚ÇÉ = 15 + 15/3 = 20
      </text>
      <text x="10" y="90" font-family="monospace" font-size="12" text-anchor="start" fill="#fff">
        Œ¥' = 30 - 20 = 10
      </text>
      <text x="10" y="110" font-family="monospace" font-size="12" text-anchor="start" fill="#fff">
        M‚ÇÇ = 50 + 15√ó10
      </text>
      <text x="10" y="130" font-family="monospace" font-size="12" text-anchor="start" fill="#fff">
           = 200
      </text>
    </g>
    
    <!-- State After -->
    <g transform="translate(0, 190)">
      <rect x="0" y="0" width="200" height="100" fill="#fff" stroke="#27ae60" stroke-width="3" rx="5"/>
      <text x="100" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#27ae60">
        After (n=3)
      </text>
      <text x="20" y="50" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        n = 3
      </text>
      <text x="20" y="70" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        Œº = 20.0
      </text>
      <text x="20" y="90" font-family="monospace" font-size="13" text-anchor="start" fill="#2c3e50">
        M‚ÇÇ = 200.0
      </text>
    </g>
  </g>
  
  <!-- Key Insight Box -->
  <g transform="translate(50, 520)">
    <rect x="0" y="0" width="900" height="60" fill="#fff3cd" stroke="#ffc107" stroke-width="2" rx="5"/>
    <text x="450" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#856404">
      üí° Key Insight: Avoids catastrophic cancellation by computing deviations from running mean
    </text>
    <text x="450" y="45" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#856404">
      Naive formula œÉ¬≤ = E[X¬≤] - E[X]¬≤ fails when variance is small relative to mean
    </text>
  </g>
</svg>

